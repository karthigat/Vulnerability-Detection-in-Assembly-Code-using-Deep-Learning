import glob
import re
import os
import pickle
import time

def main():
    total_files = []
    path = os.path.join("C:/Users/admin/PycharmProjects/auto_coding/tokenizing_w_bug/non_malicious_wo_gcc")
    # path = os.path.join("C:/Users/admin/PycharmProjects/auto_coding/tokenizing_w_bug/test/non_malicious_wo_gcc")
    source_files = glob.glob(f'{path}/**/*.asm', recursive=True)
    whole_list = []
    start = time.time()
    for file in source_files:
        with open(file, "r", encoding="utf8") as file_lines:
            add_lines = []
            for lines in file_lines:
                # print(lines)
                command_lines=re.search(";", lines)
                colon_rmv = re.search(':', lines)
                if command_lines is not None:
                        lines = lines.split(";",1)
                        if len(lines) > 1:
                            lines.remove(lines[1])
                            lines = lines[0]
                if colon_rmv is not None:
                    lines = lines.split(":",1)                   
                    lines.remove(lines[0])
                    if len(lines) > 0:
                        lines = lines[0]
                    else:
                        lines = " "
                lines=re.sub(",", " ", lines)
                rmv =  lines.strip()
                add_lines.append(rmv)
            add_lines = list(filter(None, add_lines))
            # print(len(add_lines))
        whole_list.append(add_lines)
    print(whole_list)
    time.sleep(1)
    end= time.time()
    print(end-start)
    # file_names = 'non_malicious_wo_gcc_train'
    pickle_path = "C:/Users/admin/PycharmProjects/auto_coding/tokenizing_w_bug/pickle_file/pickle_file_train_test"
    pickle_name = os.path.join(pickle_path, 'non_malicious_wo_gcc')
    # pickle_name = os.path.join(pickle_path, 'non_malicious_wo_gcc_test')
    # file_names = 'non_malicious_wo_gcc_test'
    file_pickle = os.path.join(pickle_name+'.pkl')
    print(file_pickle)
    open_file = open(file_pickle, "wb")
    pickle.dump(whole_list, open_file)
    open_file.close()


if __name__ == "__main__":
    main()